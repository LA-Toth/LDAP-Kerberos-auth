\chapter{Amavisd-New, ClamAV, SpamAssassin}
Az Amavisd-new egy általános célú levélszűrő, spam- és vírusszűrő programokat hív meg és az általuk adott válasz
alapján eldönti, hogy az adott levél spam-e, vagy épp vírusos-e.

Egy minimális konfiguráció (amit be kell állítani) a következő:

\ut{\# /etc/amavisd.conf\\
  \$mydomain = 'panthernet';\\
  \$myhostname = 'zeratul.panthernet';\\
  \$daemon\_user  = 'amavis';       \# (no default;  customary: vscan or amavis)\\
  \$daemon\_group = 'clamav';       \# (no default;  customary: vscan or amavis)\\
  \$virus\_admin = "panther@\$mydomain";\\\
  \$mail\_notify\_admin = "antivirus@\$mydomain";\\
  \$mail\_notify\_spamadmin = "antivirus@\$mydomain";\\
  \# \#\#\# http://www.clamav.net/\\
  %%	 ['ClamAV-clamd',\\
  %% 	  \textbackslash\&ask\_daemon, ["CONTSCAN \{\}\textbackslash n", "/var/run/clamav/clamd.sock"],\\
  %%	  qr/\textbackslash bOK\$/, qr/\textbackslash bFOUND\$/,\ldots\
}

Az amavisnak a clamav-vel azonos csoportban kell lennie, hogy olvashassa a clamav socket fájlját, a
\texttt{/var/run/clamav/clamd.sock}-t.
A \texttt{mail\_notify*} a levelek feladója, ha értesítést küld a rendszer, hogy spamet vagy mást talált.


Illetve be kell állítani, hogy a könyvtár (\texttt{/var/amavis}) megfelelő tulajdonú legyen:

\ut{\# chown -R amavis:amavis /var/amavis}

\section{A ClamAV beállítása}
A ClamAV alapértelmezett konfigja csak példa, ezért egy hashmark (\#) karaktert kell az ``Example'' sor elé tenni:

\ut{\# Example
  LogFile /var/log/clamav/clamd.log
  LocalSocket /var/run/clamav/clamd.sock
}

A \textt{LocalSocket} ugyanaz legyen, mint ami az \texttt{/etc/amavisd.conf}-ban szerepel. Ha ez megvan, már
működőképes a rendszer.

\section{A Postfix beállítása az Amavisd-New használatára}

A \texttt{/etc/postfix/master.cf} fájlban kell módosítani, az első három sor talán nem kell...

\ut{\# submission=587\\
  submission   inet    n       -       n       -       -       smtpd\\
  -o smtpd\_enforce\_tls=yes -o smtpd\_sasl\_auth\_enable=yes -o smtpd\_etrn\_restrictions=reject\\
  \#\#\#\\
  \# AMAVIS etc
  127.0.0.1:10025 inet n  -       n       -       -       smtpd\\
  -o content\_filter=\\
  -o local\_recipient\_maps=\\
  -o smtpd\_client\_restrictions=\\
  -o smtpd\_helo\_restrictions=\\
  -o smtpd\_sender\_restrictions=\\
  -o smtpd\_restrictions=permit\_mynetworks,reject\_unauth\_destination\\
  -o mynetworks=127.0.0.0/8\\
  -o strict\_rfc821\_envelopes=yes\\
  -o smtpd\_error\_sleep\_time=0\\
  -o smtpd\_soft\_error\_limit=1001\\
  -o smtpd\_hard\_error\_limit=1000\\
  smtp-amavis     unix    -       -       y       -       2       smtp\\
  -o smtp\_data\_done\_timeout=1200\\
  -o disable\_dns\_lookups=yes
}

\noindent A \texttt{/etc/postfix/master.cf} fájlban is kell egy új sor:

\ut{content\_filter = smtp-amavis:[127.0.0.1]:10024}

Mi is történik ekkor? A Postfix kap egy levelet a 25-ös porton. Ezt továbbadja a localhost 10024-es portjára az
amavisd-new-nak. Az amavisd-new meghívja a spam- és vírusszűrőket, majd visszaküldi a levelet a postfixnak a
localhost 10025-ös portján. Bizonyos feltételek mellett bármikor blokkolódhat a levél. Ha az amavis karanténba zárja,
akkor értesítést küld, alapesetben a localhost 10025-ös portjára.

% Local Variables:
% fill-column: 120
% TeX-master: t
% End:
