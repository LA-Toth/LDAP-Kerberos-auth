\documentclass[fleqn,10pt,a4paper,titlepage]{article}

%
% ---------- CODES --------------------------
%
\makeatletter
\gdef\th@magyar{\normalfont\slshape
  \def\@begintheorem##1##2{%
  \item[\hskip\labelsep \theorem@headerfont ##2.\ ##1.]}%
  \def\@opargbegintheorem##1##2##3{%
  \item[\hskip\labelsep \theorem@headerfont ##2. ##1.\ (##3)]}}
\makeatother

%
% - ---- -- PACKAGES--------------------------
%
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{t1enc}
\usepackage[utf8]{inputenc}
\usepackage[magyar]{babel}
%\usepackage{amsthm}
\usepackage{theorem}
\usepackage{fancyhdr}
\usepackage{paralist}
%\usepackage{color}




\newcommand{\fontos}[1]{\texttt{#1}}
\newcommand{\ut}[1]{\vspace{5mm}\fbox{\parbox{130mm}{\texttt{\noindent{#1}}}}\vspace{5mm}}
\newcommand*{\filename}[1]{\texttt{#1}}
\newcommand*{\behuzas}[1][1]{\hspace*{#1em}}
\newcommand*{\beh}[1][1]{\hspace*{#1em}}
\newcommand*{\tgt}{\textgreater}
\newcommand{\textt}{\texttt}

%\setlength{\parindent}{0pt}
%\setlength{\parskip}{\baselineskip}
\addtolength{\voffset}{-1cm}
\addtolength{\textheight}{2cm}
%\addtolength{\marginparwidth}{-1cm}
\addtolength{\hoffset}{-1cm}
\addtolength{\textwidth}{2cm}
\setlength{\headheight}{23pt}
%
\pagestyle{fancy}

\renewcommand{\sectionmark}[1]{\markboth{\Roman{section}. fejezet\\#1}{}}

\newcommand{\mktoc}{
  \pagenumbering{roman}
  \setcounter{page}{1}
  \lhead{\textbf{\thepage}}
  \cfoot{}
  \tableofcontents
  \newpage
  \lhead{\textbf{\thepage}}
  \pagenumbering{arabic}
  \setcounter{page}{1}
}

\title{Postfix, LDAP, Kerberos, SSH...}
\author{Tóth László Attila (panther@elte.hu)}
\date{2007. január 3.}
\begin{document}
  \maketitle
  \mktoc
  \newpage
  \section{Előszó}
  A számítógépek és az Internet elterjedésével egyre több helyen épülnek ki sokfelhasználós, számos szolgáltatást nyújtó
  rendszerek. A legtipikusabb szolgáltatások a bejelentkezést és a levelezést teszik lehetővé.

  Kezdetben a felhasználók hitelesítésére elegendő volt egy egyszerű szövegfájl, amely tartalmazta a felhasználó
  adatait, valamint a jelszavát is. Mindenkinek joga volt olvasni ezt a fájlt, a jelszavak tárolása ezáltal már nem volt
  biztonságos. Ezért a jelszavakat már külön állományban tárolták, amit a gépen egyetlen felhasználó, a root tudott
  olvasni, valamint írni.

  A biztonsági problémát sikerült elhárítani, azonban két további probléma váltazatlanul fennált, az egyik az, hogy
  néhány ezer vagy különösen több tízezer felhasználó esetén kezelhetetlenné vált mind módosítás mind keresés esetén. A
  másik akkor merült fel, ha egyazon felhasználónak több gépre is van bejelentkezési joga. Sokszor egy-egy központi
  szerveren létrehozzák a felhasználó fiókját, így számos egyéb gépen (például laborokban) azonos körülmények között
  folyhat a munka. A felhasználókat tároló fájlt minden gépre át kellene másolni, módosításokat követni, ami nagyon
  nehézkes. Ugyanaz a helyzet, mint a gépek azonosításával alig néhány évtizeddel ezelőtt, amikor sok gép volt már, és
  az őket azonosító számokat, valamint a könnyebb megjegyezhetőség végett bevezetett beszédes neveket összekapcsoló
  állományokat körülményes volt karbantartani. Ezért bevezették a névkiszolgálók rendszerét, s csak egy-egy gépen kell a
  módosításokat elvégezni.

  A hitelesítésnél ugyanez a megoldás, egy központi gépen tárolható a felhasználó összes adata, jelszava. Többféle
  megoldás is szóba kerülhet, például adatbázisban (MySQL, Oracle, stb.), vagy épp egy hierarchikus
  rendszerben  (pl. LDAP) történő tárolás. Az LDAP protokoll egy könnyen kezelhető, gyors megoldás nyújt, ezt valósítja
  meg az OpenLDAP szerver, valamint a Microsoft Active Directory (AD) vezérlői is. 

  Az LDAP adatbázisban is tárolható lenne a jelszó, azonban nem túl biztonságos, ráadásul minden egyes szolgáltatás
  igénybevételekor be kellene írni a jelszót. Erre is létezik megoldás, a Kerberos használata, amit az MIT mit-krb5
  programja, valamint a Heimdal valósít meg a nyílt forráskódú rendszerek esetén, és a Microsoft AD is tartalmazza.

  Az LDAP és a Kerberos segítségével bejelentkezés után többet nem kell beírni a jelszót, azonnal be lehet bejelentkezni
  másik gépre is, valamint email-eket is el lehet olvasni. Erről is lesz szó a későbbiekben.

  Az LDAP és Kerberos alapú hitelesítést használó programok együttes használatát írtam le, valamint a hozzájuk
  kapcsolódó egyéb szolgáltatásokat is, amelyre példa a spam- és vírusszűrés.

  Az itt bemutatott rendszer GNU/Linux alapú, amelynek számos terjesztése (disztribúciója) létezik, a beállítások
  elsősorban a Gentoo Linux esetén néznek ki így, azonban a többi terjesztésen is hasonlóan oldható meg.

  A következő oldalakon az alábbi programok beállítása található meg:
  OpenLDAP,
  MIT-Krb5 (Kerberos),
  Tanúsítvány-kiszolgáló (Certificate Authority),
  PAM,
  Cyrus saslauthd,
  OpenSSH,
  Postfix,
  Amavisd-new,
  ClamAV,
  SpamAssassin,
  SSL/TLS titkosítás az előző programok esetén
  
  A fenti programok beállításait lépésről lépésre nézzük át, hogy végül egy egységesen működő rendszert kapjunk.
  
  \newpage
  \section{Az OpenLDAP}
  Az openldap az LDAP protokollt ({\em Lightweight Directory Access Protocol}) valósítja meg. Ez egy könyvtárszolgáltatás
  (directory service) elérésére szolgál, aminek jellemzője, hogy olvasásra, keresésre, böngészésre (átnézésre)
  optimalizált adatbázist használ az adatok tárolására. Az adatbázis lényegében \emph{bármilyen adatot} tartalmhazhat
  \emph{bármiről}, az egyetlen megkötés, hogy faszerkezetű hierarchiába kell szervezni.

  Az OpenLDAP általában TCP/IP kapcsolatot használ az adatok elérésére, bár a helyi gépen (ahol az ldap kiszolgáló
  található), unix socketet is használhat.
  
  \subsection{Mi LDAP (röviden)?}
  A benne tárolt adatokat egy-egy egyedi név: {\em Distinguished Name (DN)} azonosítja. A név több részből áll, a
  különböző részek alapján faszerkezetű hierarchiába szervezhetőek a bejegyzések. Minden bejegyzéshez tartozik egy vagy
  több tulajdonság, amit egy {\em típus-érték} pár határoz meg. A típus lehet például a ``common name'' (cn) - mindennapi
  név, a hozzá tartozó érték meg ``Gipsz Jakab'', vagy épp a levélcím megadására szolgáló ``mail'' mező.

  A fa csúcsainak elhagyható és kötelező tulajdonságait az objektum (csúcs) osztályai írják le
  (tulajdonságosztályok). A nevük: \texttt{objectclass}, és maguk is (speciális) tulajdonságok.

  \subsection{Beállítások}
  A beállítások a /etc/openldap alatt találhatóak.

  \subsubsection{A /etc/openldap/slapd.conf}
  Ez a fájl határozza meg a kiszolgáló működését. Csak a szerver felhasználója olvashatja. Több részből áll:
  \begin{itemize}
  \item Sémák (a használható attribútumokat adják meg)
  \item Hozzáférés-vezérlési listák (ACL)
  \item Titkosítás, hitelesítés és egyéb információk
  \item A (háttér)adatbázis típusa, a keresést segítő index módja
  \item Az LDAP faszerkezet csúcsát jelölő név
  \item A szuperfelhasználó egyedi neve és jelszava (mindent olvas, és ír, az ACL nem érvényes rá)
  \end{itemize}  

  \paragraph{Séma} Az általunk használt séma az alábbi:

  \ut{include\hspace{1.5cm} /etc/openldap/schema/core.schema\\
    include\hspace{1.5cm} /etc/openldap/schema/cosine.schema\\
    include\hspace{1.5cm} /etc/openldap/schema/inetorgperson.schema\\
    include\hspace{1.5cm} /etc/openldap/schema/nis.schema\\
    include\hspace{1.5cm} /etc/openldap/schema/misc.schema}
  
  Itt az első a rendszernek kell lényegében, a következő három az általánosan használt attribútumokat tartalmazza
  (többek között a felhasználók definiálásához). Az utolsó ``\texttt{misc}'', azaz nem megszokott, most az ebben
  definiáltakkal lesz meghatározva az a cím, amelyre érkezett leveleket az adott felhasználó fogadhatja, illetve melyre
  továbbküldheti (ha nem küldi tovább, akkor is szükséges). Az ldap-ban tárol álnevek (aliasok) meghatározásához is
  szükséges.
  
  \paragraph{Jogok (ACL)} A következő beállítás nagyon alapszintű, érdemes alaposabban utánaolvasni az openldap
  leírásában, vagy épp az interneten. 

  \ut{access to attr=userPassword\\
    \beh[3] by dn="cn=admin,dc=panthernet" write\\
    \beh[3] by anonymous auth\\
    \beh[3] by self write\\
    \beh[3] by * none\\\\
    access to dn.children="dc=panthernet" by * read\\
    \\
    \# The admin dn has full write access\\
    access to dn.children="ou=People,dc=panthernet"\\
    \beh[3] by dn="cn=admin,dc=panthernet" write\\
    \beh[3] by self write\\
    \beh[3] by * read\\\\
    access to * by * none}


  Az itt látható jogosultság azt mondja, hogy a \texttt{userPassword} (jelszó) tulajdonságot írhatja az ``admin'', és a
  bejegyzés (önmaga). Az admin egy különleges felhasználó, mert nincsen bent a Kerberosban, és különbözik a slapd.conf
  fájlban megadottól is. Csak neki van igazi jelszava az ldap adatbázisban.  Ha nem lenne Kerberos, akkor viszont
  mindenkié itt lenne. Ezért a ``\texttt{by self write}'' sor el is hagyható (javasolt). Névtelenül egyéltalán nem lehet
  hozzáférni, mert hitelesítés szükséges (``\texttt{anonymous auth}''), mindenki másnak nincs rá joga.

  Ezt leszámítva a teljes \texttt{dc=panthernet} alatti fát olvashatja mindenki (2. bejegyzés).

  A harmadik megint túl megengedő, mert a ``\texttt{self write}'' itt is felesleges, csak egyes attribútumokra kellene
  engedni.

  \paragraph{A fa gyökere és a root ``user''}  A faszerkezet gyökerét, aminek a neve minden csúcs nevének végződése, a
  \texttt{suffix} beállítás jelzi. A ``root'' felhasználót a ``\texttt{rootdn}'' és a ``\texttt{rootpw}'' pár
  azonosítja.
  
  \ut{suffix\hspace{1.5cm} "dc=panthernet"\\
    rootdn\hspace{1.5cm} "cn=administrator,dc=panthernet"\\
    rootpw\hspace{1.5cm} \{SSHA\}blabla}

  Mint látható, a jelszót is meg kell adni. Lehetne titkosítás nélküli (cleartext) jelszót is megadni, de ez nem
  célszerű. Érdemes titkosítani, és az így kapott jelszót megadni. Az SSHA egy megfelelő algoritmus, egyirányú, ezért
  nem lehet a jelszót visszaállítani, csak bruteforce-szal törhető (és szótári támadással). Tehát a jó jelszó: kis-
  és nagybetűk, számok vegyesen, lehetőleg egyéb nyomtatható karakterekkel (pl \#, \&, !, stb) megtűzdelve, minél
  hosszabb. Mivel a jeslszó hash formájában tárolódik, ezért több különböző jelszót megadva azonos hash-t kapunk. SHA1
  esetén 160 bites a hash hossza, ennél hosszabb jelszavak esetén garantáltan lesz több egyező is.

  Ha kerberossal hitelesített a felhasználó, aki hozzáfér a jelszóhoz és módosítja, akkor egy-egy rondább jelszót elég
  csak bejelentkezésenként egyszer megadni, minden egyéb szolgáltatásnál már nem szükséges.

  A jelszó előállítására szolgál a \texttt{slappaswd} parancs, ennek kimenetét kell bemásolni. Használata:\\
  \ut{slappasswd -h {SSHA}}

  \paragraph{Az adatbázis} Meg kell adni azt is, hogy milyen adatbázist használjon a háttérben az openldap szerver
  (milyen {\em backendet}).

  \ut{database        bdb\\
   checkpoint      32      30 \# \textless kbyte\textgreater \textless min\textgreater\\
   \# The database directory MUST exist prior to running slapd AND\\
   \# should only be accessible by the slapd and slap tools.\\
   \# Mode 700 recommended.\\
   directory       /var/lib/openldap-data\\
   \# Indices to maintain\\
   index   objectClass     eq
  }

  Az adatbázis (\texttt{database}) lehet többféle, a legegyszerűbb az \texttt{ldbm}, a legjobb választás a
  \texttt{bdb}. A \texttt{directory} beállításnak megfelelelő könyvtárban lesz az adatbázis. A könyvtárra a \texttt{700}
  jogot ajánlott megadni, hogy ne tudja a könyvtár tulajdonosán más is olvasni a fájlokat. Az  \texttt{index} a
  kereséshez használt index.
  
  \paragraph{Kerberos, TLS, és ami még kimaradt} Az a jó, ha a szervert csak titkosítottan (TLS-sel) érhetjük el. TLS =
  Transport Layer Security. Beállítása:\\
  \ut{\begin{tabular}{ll}
      TLSCACertificateFile & /etc/openldap/ssl/cacert.pem\\
      TLSCertificateFile & /etc/openldap/ssl/ldaps.panthernet.crt\\
      TLSCertificateKeyFile & /etc/openldap/ssl/ldaps.panthernet.key\\
      TLSCipherSuite &  Medium,Heigh
  \end{tabular}}
  
  Az első sor jelzi a tanúsítvány-kiszolgáló (CA) tanúsítványát (certificate). A második az openldapét, a harmadik pedig
  az openldap titkos kulcsa (key). Ennek a fájlnak kötelezően 600 jogúnak kell lennie, nem szabad, hogy bárki is olvasni
  tudja. Az utolsó sor csak a közepes és erős titkosító algoritmusokat engedélyezi.
  
  A maradék beállítás:
  
  \ut{sasl-realm panthernet\\
    sasl-regexp uid=([\^,]+),.*cn=GSSAPI uid=\$1,ou=People,dc=panthernet\\
    sasl-host zeratul.panthernet\\
    LogLevel 0}
  
  A \texttt{LogLevel} mondja meg, mennyire bőbeszédűen (verbose) írja bele a syslogba, hogy mi történik. A ``0'' érték
  hatására szinte semmit sem ír, hibakeresésnél jön jól.

  A \texttt{sasl-realm} azt az ún. realm-ot határozza meg, amiben a kerberos bejegyzések vannak. A \texttt{sasl-host} a
  kiszolgáló helyét mondja meg, \texttt{sasl-regexp} pedig azt, hogy hogyan lehet megtalálni azt a bejegyzést, aki
  csatlakozott a szerverhez.

  
  \subsubsection{A /etc/openldap/ldap.conf}
  Ez a fájl mondja meg, hogy az \texttt{ldapsearch}, és hasonló parancsok alapesetben milyen géphez, milyen protokollal
  és milyen végződésű helyhez (lásd a fentebbi \texttt{suffix}, itt \texttt{BASE}) csatlakozik. A fájl mindenki által
  olvasható.
  
  \ut{BASE    dc=panthernet\\
    URI     ldaps://ldaps.panthernet\\
    TLS\_CACERT /etc/openldap/ssl/cacert.pem }
  
  A \texttt{BASE} az, ami alatt keres (részfát határoz meg), a \texttt{URI} azt, hogy titkosított protokollon (ldaps), az
  ``ldaps.panthernet'' nevű gépen érhető el a szerver. A titkosítás miatt meg kell adni azt a helyet, ahol a CA
  tanúsítványa található, ez a \texttt{TLS\_CACERT} beállítás.
  
  \subsection{A rendszer felkészítése az ldap használatához}
  A fentiek elvégzése után még csak a szerver beállítása és a kapcsolódás módja adott. Ahhoz, hogy az ldapban tárolt
  felhasználók ténylegesen létezhessenek az adott gépen, fel kell rakni az ``nss\_ldap'' csomagot. Általában az ldap
  szerver különálló gépen található, de nincs mindig így, ezért néha azon is be kell állítani a csomagot
  (\filename{/etc/ldap.conf} tartalmazza a beállításait).

  \subsubsection{nss-ldap}
  A \filename{/etc/ldap.conf} néhány fontos beállítása:
  
  \ut{base dc=panthernet\\
    uri ldaps://ldaps.panthernet/\\
    \# The distinguished name to bind to the server with.\\
    \# Optional: default is to bind anonymously.\\
    \#binddn cn=proxyuser,dc=padl,dc=com\\
    \\
    \# The credentials to bind with.\\
    \# Optional: default is no credential.\\
    \#bindpw secret}
  
  Az első kettő lényeges. Ez egyik szerver elérését mondja meg (\texttt{uri}): ldaps, azaz titkosított, utána a gép neve,
  a másik, a \texttt{base} pedig a faszerkezet egy csúcsát, ami alatt keres a rendszer (\texttt{ou=People},
  \texttt{ou=Group}).

  A \texttt{binddn} és a \texttt{bindpw} segítségével elérhető, hogy névtelenül ne lehessen a szerverhez csatlakozni,
  onnan információkat gyűjteni, csak az itt megadott ``felhasználó'' és jelszó tudjon. Igazából a fa bármely csúcsa
  lehet, ha annak van joga olvasni szinte bármit, kivéve például a \texttt{userPassword} tulajdonságot. Ehhez a sor
  eleji ``\#'' karaktert (megjegyzés jele) ki kell törölni, és érvényes adatot írni a helyére.

  A fájl többi részét nem kell (de lehet) módosítani.
  
  
  \paragraph{nsswitch.conf} Az ldap szerverhez történő csatlakozást a fentebb látható módon garantáltuk, de ez
  kevés. Még meg kell mondani, hogy az információkat onnan (is) vegye. Ezt a \filename{/etc/nsswitch.conf} fájl
  módosításával tehető meg.
  
  \ut{\begin{tabular}{ll}passwd:& files ldap\\
    shadow:& files ldap\\
    group: & files ldap\end{tabular}}
  
  Vagyis a jelszavakat, shadow jelszavakat és a csoportokat egyrészt a helyi fájlokból, másrészt ldapból olvassa ki (az
  elől álló nevek a \texttt{/etc/} alatti fájlneveket jelzik.

  \subsection{Az adatok feltöltése}
  Ha ideiglenesen a TLS-re és a Kerberos (SASL) realm-ra vonatkozó információkat kivesszük, akkor már most tesztelhető a
  rendszer a következő utasítással (keresés), ami ``üres'' kimenetet ad.\\
  \texttt{ldapsearch -x}
  
  A mostani példában felhasználók, csoportok és email aliasok (álnevek) szerepelnek. Az ezek szülőcsúcsáig bezárólag
  kézzel kell (érdemes) létrehozni a fát, utána már lehet szkriptekkel is beszúrni az adatokat.



  \subsubsection{Az LDAP bejegyzések hozzáadása}

  Az ldap a bejegyzéseket LDIF formátumban jeleníti meg (például az ldapsearch és slapcat parancsok kimenete ilyen), és
  ezt a formátumot használva lehet adminisztrálni is. Ezért az összes bejegyzés (csúcs) ilyen formában van itt is.

  A \texttt{dc} az egyedi név, az \texttt{o} a szervezet (organization) rövidítése. A fenti objektum (csúcs) a fa
  gyökere:

  \ut{dn: dc=panthernet\\
    objectClass: dcObject\\
    objectClass: organization\\
    dc: panthernet\\
    o: PantherNetwork}
  

  Ez a \filename{slapd.conf} fájlban definiált ``felhasználó''. Valójában nem is felhasználó, ezért is más az
  objectClass. Kettő is van neki, a második (\texttt{top}) csak annyit jelent, hogy az objektumnak lehetnek
  gyerekei. Ezért ez egy felesleges objectClass, de nem helytelen.
  
  \ut{dn: cn=Manager,dc=panthernet\\
    objectClass: organizationalRole\\
    objectClass: top\\
    cn: Manager}

  A Manager-től független adminisztrátori jogokkal rendelkező bejegyzés. Nem kötelező, mégis jobb, ha szét vannak
  választva a jogosultságok, akár több részre is.\\ A \texttt{simpleSecurityObject} tartalmazza a \texttt{userPassword}
  tulajdonságot. A \texttt{description} mező pedig a leírás, melyet bármely objektum tartalmazhat.
  
  \ut{dn: cn=admin,dc=panthernet\\
    objectClass: organizationalRole\\
    objectClass: simpleSecurityObject\\
    cn: admin\\
    description: LDAP administrator\\
    userPassword: {SSHA}blabla}
  

  Ez a bejegyzés alá kerül az összes (valódi) felhasználó. Szervezeti egységet jelent az \textt{organizationalUnit}:

  \ut{dn: ou=People,dc=panthernet\\
    objectClass: organizationalUnit\\
    ou: People}

  A következő egy felhasználói bejegyzés. Nagyon sok tulajdonság kitöltetlen. A \texttt{top} jelentése már elhangzott.
  
  Az \texttt{inetorgPerson} többek között a következő opcionális tulajdonságokat határozza meg (inetorgperson.schema):
  \texttt{homePhone}, \texttt{homePostalAddress}, \texttt{initials}, \texttt{mail},  \texttt{mobile},
  \texttt{roomNumber}, \texttt{uid}.
  
  A \textt{person} (\texttt{core.schema}) esetén az \texttt{sn}, \texttt{cn} attribútumokat kötelező definiálni
  (vezetéknév az sn). Opcionális többek között: \texttt{ userPassword}, \texttt{telephoneNumber}.
  
  
  Az \texttt{organizationalPerson} valamilyen szervezethez tartozó személyt jelent. Itt többek között
  \texttt{telephoneNumber}, \texttt{ou} (azaz a szervezeti egység), \texttt{postalAddress} tulajdonságok szerepelnek.

  A \texttt{inetLocalMailRecipient} a misc.schema-ban definiált, \texttt{mailLocalAddress}, \texttt{mailHost} ,
  \texttt{mailRoutingAddress} az opcionális tulajdonságai. Ebből az első az, amire érkeznek a levelek, az utolsó meg
  amire mennek. Ha helyi fiók (pl. panther), akkor a levelezőszervernek (pl. Cyrus) továbbítódik, különben a megadott
  címre.

  A \texttt{posixAccount} és \texttt{shadowAccount} tartalmazza a \texttt{/etc/passwd} és \texttt{/etc/shadow} fájlban
  is megtalálható információjat.
  

  \ut{dn: uid=panther,ou=People,dc=panthernet\\
    objectClass: top\\
    objectClass: person\\
    objectClass: inetOrgPerson\\
    objectClass: organizationalPerson\\
    objectClass: inetLocalMailRecipient\\
    objectClass: posixAccount\\
    objectClass: shadowAccount\\
    cn:: VMOzdGggTMOhc3psw7MgQXR0aWxh\\
    cn:: TMOhc3psw7MgQXR0aWxhIFTDs3Ro\\
    uid: panther\\
    mobile: 06\\
    homePostalAddress: Erd\\
    mailRoutingAddress: panther\\
    mailLocalAddress: Toth.Laszlo.Attila\\
    mailLocalAddress: Laszlo.Attila.Toth\\
    gecos: Toth Laszlo Attila\\
    sn:: VMOzdGg=\\
    homeDirectory: /home/panther\\
    loginShell: /bin/bash\\
    uidNumber: 1000\\
    gidNumber: 100\\
    givenName:: TMOhc3psw7MgQXR0aWxh}

  Illetve:
  
  \ut{dn: uid=parad,ou=People,dc=panthernet\\
    objectClass: top\\
    objectClass: person\\
    objectClass: inetOrgPerson\\
    objectClass: organizationalPerson\\
    objectClass: inetLocalMailRecipient\\
    objectClass: posixAccount\\
    objectClass: shadowAccount\\
    cn: Nagy Adrienn\\
    cn: Adrienn Nagy\\
    gecos: Nagy Adrienn\\
    sn: Nagy\\
    givenName: Adrienn\\
    uid: parad\\
    mailRoutingAddress: parad\\
    mailLocalAddress: Nagy.Adrienn\\
    mailLocalAddress: Adrienn.Nagy\\
    homeDirectory: /home/parad\\
    loginShell: /bin/bash\\
    uidNumber: 1001\\
    gidNumber: 100}

  \newpage
  Az email aliasokat tartalmazó ág csúcsa:

  \ut{ dn: ou=MailAliases,dc=panthernet\\
    ou: MailAliases\\
    objectClass: top\\
    objectClass: organizationalUnit
  }
  
  Egy alias az account objectClass az uid attribútum miatt kell. A mailRoutingAddress-ben szóközzel elválasztott címekre
  továbbítódik a levél:
  
  \ut{dn: uid=mindenki,ou=MailAliases,dc=panthernet\\
    objectClass: account\\
    objectClass: top\\
    objectClass: inetLocalMailRecipient\\
    mailLocalAddress: mindenki\\
    mailLocalAddress: everyone\\
    mailLocalAddress: everybody\\
    uid: mindenki\\
    mailRoutingAddress: panther}
  
  A csoportokat tartalmazó szervezeti egység:
  
  \ut{dn: ou=Group,dc=panthernet\\
    objectClass: organizationalUnit\\
    ou: Group}
  
  Egy csoportbejegyzés (több felhasználó is a tagja):

  \ut{dn: cn=testgrp,ou=Group,dc=panthernet\\
    objectClass: top\\
    objectClass: posixGroup\\
    cn: testgrp\\
    gidNumber: 10000\\
    memberUid: panther\\
    memberUid: parad}
  
  
  Ezeket a bejegyzéseket fájlba mentve egyből hozzáadhatjuk a futó ldap szerverhez kapcsolódva:\\
  \texttt{ldapadd -xWD cn=Manager,dc=panthernet -f fájlnév.ldif}

 
  
  \subsubsection{Az LDAP bejegyzések módosítása}

  A módosításokat is LDIF formában kell megadni, a használt parancs:
  \texttt{ldapmodify -xWD cn=Manager,dc=panthernet -f fájlnév.ldif}
  
  Attribútum hozzáadása:
  
  \ut{dn: uid=panther,ou=People,dc=panthernet\\
    changeType: modify\\
    add: userPassword\\
    userPassword: \{KERBEROS\}panther@PANTHERNET\}}
  
  \newpage
  Lehet törölni is egy attribútumot, például:
  
  \ut{dn: uid=panther,ou=People,dc=panthernet\\
      changeType: modify\\
    delete: userPassword}
  
  Ha egy adott attribútumot (amiből több különböző értékű is lehet) kellene, akkor:
  
  \ut{dn: uid=panther,ou=People,dc=panthernet\\
    changeType: modify\\
    delete: mail\\
    mail: panther@elte.hu}

  A teljes bejegyzés törlése:

  \ut{dn: uid=panther,ou=People,dc=panthernet\\
    changeType: delete}
  
  
  \newpage
  \section{Tanúsítvány-kiszolgáló (CA) beállítása}
  
  Az SSL/TLS titkosítást használó szerverek mindegyike egy-egy tanúsítványt küld a kliensnek. Mire is jó ez? A
  kiszolgálót hitelesíti ez, vagyis azt jelzi, hogy a kliens biztosan azzal kommunikál, akivel szeretne. Azaz csak
  majdnem. Ugyanazzal a tanúsítvánnyal rendelkező szerverrel.
  
  Alapesetben önaláírtak ezek, vagyis hitelességi értékük csak annyi, hogy elvileg megint ugyanahhoz kapcsolódik a
  szerver. No de ha új tanúsítványa lesz a szervernek, akkor máris nem megbízható. Legjobb választás az lenne, ha
  egyszerűen nem fogadnánk el ilyet, ha van beleszólásunk.

  Van más megoldás is: saját tanúsítvány-kiszolgáló (CA) beállítása, és ennek ún {\em gyökértanúsítványát, root
  certificate-jét} aláiratni egy másik, sokak által ismert tanúsítványkiszolgálóval, vagy csak az adott szerverét
  aláiratni. Ez pénzbe kerül. Ha ezt el szeretnénk kerülni, akkor is jó a CA használata, ennek certificate-jét
  importálva/felhasználva sok helyen (fentebb már láttunk rá példát), pl böngészőhöz is hozzáadva.
  
  \subsection{openssl.cnf}
  Ez a fájl írja le a CA működését. Több CA is lehet benne, ebből egyik az alapértelmezett (lásd a CA szakasz).

  A CA\_default az a CA, amit most használunk, lehetne más neve is, csak így utal arra, hogy ő az alapértelmezett.

  \ut{[ ca ]\\
    default\_ca      = CA\_default}
    
  \ut{\begin{tabular}{ll}
      [ CA\_default ] & \\
      dir             &= /root/panthernet.ca\\
      certs           &= \$dir/certs\\
      crl\_dir         &= \$dir/crl\\
      database        &= \$dir/ca.db.index\\
      new\_certs\_dir   &= \$dir/newcerts\\
      &\\
      certificate     &= \$dir/ca/cacert.pem\\
      serial          &= \$dir/ca.db.serial\\
      &\\
      crl             &= \$dir/crl.pem\\
      private\_key    &= \$dir/ca/private/cakey.pem\\
      RANDFILE        &= \$dir/ca.db.rand\\
      &\\
      x509\_extensions &= usr\_cert\\
      &\\
      name\_opt        &= ca\_default\\
      cert\_opt        &= ca\_default\\
      default\_days    &= 365\\
      default\_crl\_days &= 30\\
      default\_md      &= md5\\
      preserve        &= no\\
      policy          &= policy\_match\end{tabular}}

  \ut{\begin{tabular}{ll}
      [ policy\_match ] & \\
      countryName             &= match\\
      stateOrProvinceName     &= optional\\
      organizationName        &= match\\
      organizationalUnitName  &= optional\\
      commonName              &= supplied\\
      emailAddress            &= supplied
    \end{tabular}
  }
  
  A második lista a CA beállításait tartalmazza, a harmadik pedig azt, hogy a CA mikor tud aláírni egy tanúsítványt:
  minek kell egyeznie, mi az, ami nem kötelező, és mi az, ami kötelező, de bármi lehet.

  Megadható az is, hogy alapértelmezetten mivel legyen kitöltve a tanúsítvány, valamint hogy milyen kérdések
  szerepeljenek, csakúgy, mint az alapértelmezett kulcshosszt is. Ennek részlete:

  \ut{\begin{tabular}{ll}
      [\ req\ ]&\\
      default\_bits           &= 1024\\
      distinguished\_name     &= req\_distinguished\_name
    \end{tabular}
  }
  
  \ut{\begin{tabular}{ll}
      [\ req\_distinguished\_name\ ]&\\
      countryName                     &= Country Name (2 letter code)\\
      countryName\_default             &= HU\\
      countryName\_min                 &= 2\\
      countryName\_max                 &= 2\\
      stateOrProvinceName             &= State or Province Name (full name)\\
      stateOrProvinceName\_default     &=\\
      localityName                    &= Locality Name (eg, city)\\
      localityMame\_default            &= Budapest\\
      0.organizationName              &= Organization Name (eg, company)\\
      0.organizationName\_default      &= PantherHome\\
      organizationalUnitName          &= Organizational Unit Name (eg, section)\\
      commonName                      &= Common Name (eg, YOUR name)\\
      commonName\_max                  &= 64\\
      emailAddress                    &= Email Address\\
      emailAddress\_max                &= 64\\
    \end{tabular}
  }
  
  
  
  A CA tanúsítványának létrehozása, 10 évig érvényesen:\\
  \texttt{openssl req -config /root/panthernet.ca/openssl.cnf \textbackslash\\
    \beh[2] -new -x509 -keyout /root/panthernet.ca/ca/private/cakey.pem \textbackslash\\
    \beh[2] -out /root/panthernet.ca/ca/cacert.pem  -days 3650}\\
 
  A következő script hoz létre egy ``kérést'' (request) aláírásra, vagyis az aláiratlan  tanúsítványt (.csr: certificate
  sign request) és a hozzá tartozó  privát kulcsot (.key fájl).
  
  \ut{\#!/bin/bash\\
    \# file: pnet-careq\\
    if [[ \$\# != 1 ]]; then exit 4; fi\\
    openssl req -config /root/panthernet.ca/openssl.cnf  -nodes \textbackslash\\
    \beh[2] -newkey rsa:2048  -keyout \$1.key -out \$1.csr}
  
  Az előző szkript által generált adatot alá is irathatjuk. A létrehozott, aláírt tanúsítvány a .crt kiterjesztésű
  fájlba kerül.
  
  \ut{\#!/bin/bash\\
    \# file: pnet-casign\\
    if [[ \$\# != 1 ]]; then exit 4; fi\\
    openssl ca -config /root/panthernet.ca/openssl.cnf  -policy policy\_match \textbackslash \\
    \beh[2] -out \$1.crt -infiles \$1.csr}

  Aláírásra példa:

  \ut{zeratul panthernet.certs \# pnet-casign ldaps.panthernet\\\hspace*{1mm}
    Using configuration from /root/panthernet.ca/openssl.cnf\\
    Enter pass phrase for /root/panthernet.ca/ca/private/cakey.pem:\\
%    DEBUG[load\_index]: unique\_subject = "yes"\\
    Check that the request matches the signature\\
    Signature ok\\
    Certificate Details:\\
    Serial Number: 1 (0x1)\\
    \hspace*{1mm}\ \ \ \ \ \ \ \ Validity\\
    \hspace*{1mm}\ \ \ \ \ \ \ \ \ \ \ \ Not Before: Oct 15 10:36:30 2005 GMT\\
    \hspace*{1mm}\ \ \ \ \ \ \ \ \ \ \ \ Not After : Oct 15 10:36:30 2006 GMT\\
    \hspace*{1mm}\ \ \ \ \ \ \ \ Subject:\\
    \hspace*{1mm}\ \ \ \ \ \ \ \ \ \ \ \ countryName\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ = HU\\
    \hspace*{1mm}\ \ \ \ \ \ \ \ \ \ \ \ organizationName\ \ \ \ \ \ \ \ \ \ = PantherHome\\
    \hspace*{1mm}\ \ \ \ \ \ \ \ \ \ \ \ commonName\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ = ldaps.panthernet\\
    \hspace*{1mm}\ \ \ \ \ \ \ \ \ \ \ \ emailAddress\ \ \ \ \ \ \ \ \ \ \ \ \ \ = postmaster@panthernet}

  \section{Postfix}
  
  \subsection{/etc/postfix/main.cf}
  A postfix beállításait tartalmazza, például milyen címeket fogadjon el, aliasok hol vannak, levélküldés esetén myilen
  gépnevet adjon meg...
  
  \ut{myhostname = zeratul.panthernet\\
    mydomain = panthernet\\
    myorigin = \$myhostname\\
    mydestination = \$myhostname, localhost.\$mydomain, localhost, \$mydomain\\
    relayhost = smtp.axelero.hu\\
    alias\_maps = hash:/etc/mail/aliases,\\
    \beh[2] ldap:/etc/postfix/ldapaliases-mailaliases.cf, \\
    \beh[2] ldap:/etc/postfix/ldapaliases-people.cf}

  
  Alapesetben a \texttt{mydomain} a \texttt{myhostname} végével egyezik meg (nem kötelez megadni). Az SMTP protokollban
  ez utóbbi szerepel, vagyis amikor a levelet elküdli a postfix, akkor ilyen néven csatlakozik a másik szerverhez
  (\$myhostname). A \texttt{myorigin} az, ami után megadott gépnév fog szerepelni az elkldött levél feladójaként és akár
  címzettként is. Például a root küld egy levelet saját magának: \texttt{mail root}. Ekkor mind a feladó, mind a címzett
  root@\$myorigin lesz.
  
  A \textt{mydestination} vesszővel elválasztott lista, azon gépneveket tartalmazza, amelyekre fogad levelet, vagyis az
  itt felsorolt nevekhez tartzó felhasználók (pl \texttt{user@\$mydomain}) leveleit nem egy másik smtp szervernek
  továbbítja, hanem az imap, pop, stb kiszolgálónak, ahonnan az adott felhasználó letöltheti leveleit.
  
  A \texttt{relayhost} az, ahova alapesetben (kivéve a \filename{/etc/postfix/transport} fájlban megadott címzetteket,
  tartományokat) továbbítja a leveleket. Többféle formátumban meg lehet adni, IPv6-ot is támogat. Formáutma pl a fenti,
  aztán 192.168.0.1:25 is lehet (port számmal). A lehetőségek a konfigurációs fájlban megjegyzésben láthatók.
  
  Amennyiben nincsen \texttt{relayhost}, akkor közvetlenül a címzett levelezőszerveréhez csatlakozik (amit a cím domain
  részéhez tartozó MX dns bejegyzésből vesz).

  Az \texttt{alias\_maps} mondja meg, hogy egy adott email címhez tartozó levelek hova továbbítódjanak. Itt most az
  \filename{aliases} fájlban találhatóak, valamint ldap-ban, a két fájl különböző beállításokat tartalmaz.
  
  \subsection{/etc/mail/aliases}
  Debian rendszereken ennek a fájlnak a helye: \filename{/etc/aliases}.
  
  Formátumra részlet:\\
  \ut{webmaster:  root\\
    www:                webmaster\\
    \\
    levlista: panther@elte.hu root}
  
  Jelen esetben a www címre küldött levelek a webmasternek továbbítódnak, ami még mindig csak virtulális cím, vagyis a
  neki címzett levelek a root felhasználónak továbbítódnak. Így a www címre küldött leveleket is a root kapja meg.
  
  Kisebb, statikus levelezési listák is megadhatóak így, ahol több címzett van.

  A Postfix ezt még nem kezeli, ezért adatbázist kell létrehozni belőle (erre utal a \texttt{hash} a fájlnév előtt), ez
  a \texttt{/usr/bin/newaliases} paranccsal tehető meg. A létrehozott fájl: /etc/mail/aliases.db.

  
  
  \subsection{/etc/postfix/ldapaliases.cf}
  Az ldap-ban történő keresést az alábbi szerkezetű fájl teszi lehetővé.

  \ut{server\_host = ldap://ldaps.panthernet:389\\
    search\_base = ou=MailAliases,dc=panthernet\\
    version = 3\\
    scope = one\\
    bind = no\\
    query\_filter = (maillocaladdress=\%s)\\
    result\_attribute = mailroutingaddress\\
    dereference = 3\\
    timeout = 10}
  
  Az első sor azt az URI-t adja meg, ami a szervert azonosítja. A postfix a \texttt{search\_base} beállításban megadott
  csúcs alatti részfában keres. Mivel a \texttt{scope} értéke ``one'', az előbb megadott csúcs gyerekeit nézi végig. A
  3-as verzió  a mostani. A \texttt{bind = no} a névtelen kapcsolódást teszi lehetővé (mint a /etc/ldap.conf-ban a
  hasonló beállítás).

  \newpage
  \section{Kerberos}

  Egy részletes leírás itt olvasható: http://cfhay.inf.elte.hu/kerberos/leiras.html

  A Kerberos a felhasználók (és szolgáltatások) biztonságos hitelesítésére szolgál. Amikor valaki bejelentkezik a gépre
  a jelszójával, akkor kap egy őt azonosító \emph{ticket}-et, jegyet. Ezzel igényelhet továbbiakat, például amikor
  továbbssh-zik egy másikra, vagy éppen elolvassa a levleleit.
  
  A DNS-hez hasonlóan itt is tartományok vannak, csak ezeket \emph{realm}-oknak hívják. Például az example.com-hoz
  tartozó realm EXAMPLE.COM (vagyis a domain név nagybetűs alakja, megszokásból, ugyanis nem kötelező így
  eljárni). Nálam ez PANTHERNET.

  Bejelentkezés után kapott ``jegy'' a \texttt{krbtgt/PANTHERNET@PANTHERNET} lesz. Itt a név a krbtgt (pontosabban
  krbtgt/PANTHERNET) és a realm a ``@'' után álló rész, ami szintén PANTHERNET. Az adott felhasználó,
  pl. \texttt{panther} bejegyzése a \texttt{panther@PANTHERNET} alakú, a néven kívül további tulajdonságok is tartoznak:
  mikor jár le a jelszó, milyen lehet (bármilyen, vagy pl. kell kisbetű is, szám is, stb.). Ez a kettő szorosan
  összekapcsolódik. Az utóbbi a felhasználót azonosítja, az előbbi a kerberizált szolgáltatások elérésére szolgál, ezért
  is a neve \emph{ticket granting ticket}, vagyis további jegyeket biztosító jegy.
  
  Egy realm nem csak felhasználókat tartalmaz, hanem szolgáltatásokat is, ezek formája:
  \texttt{szolgáltatásnév/gépnév@REALM}. Ilyen például a \texttt{imaps/zeratul.panthernet@PANTHERNET}. Ezt a jegyet
  akkor kapjuk meg, ha már egyszer bejelentkeztünk az imap szerverre. SSH szerver használata esetén pédául a
  \texttt{host/fenix.panthernet@PANTHERNET} jegyet kapjuk meg.

  Ebben a dokumentumban a \emph{mit-krb5} változatról lesz szó, viszont létezik másik implementáció is, a \emph{heimdal}.

  A jegyet nevezhetjük kulcsnak is, és akkor kulcskiosztó szerverünk van (KDC).
  \subsection{A kerberos beállítása}
  A legfontosabb beállásokat a \texttt{/etc/krb5.conf} tartalmazza.
  
  \subsubsection{/etc/krb5.conf illetve DNS bejegyzések}
  A fájlt mindenki olvashatja. Nálam ezek a beállítások vannak:

  \ut{[libdefaults]\\
    \hspace*{2cm}ticket\_lifetime = 86400\\
    \hspace*{2cm}default\_realm = PANTHERNET\\
    \hspace*{2cm}forwardable = true\newline\newline
	    [realms]\\
	    \hspace*{2cm}PANTHERNET = \{\\
	          \hspace*{2cm}kdc = 10.0.0.2:88\\
	          \hspace*{2cm}admin\_server = 10.0.0.2:749\\
	          \hspace*{2cm}\}\newline\newline
			  [domain\_realm]\\
			  \hspace*{2cm}.panthernet = PANTHERNET\\
			  \hspace*{2cm}panthernet = PANTHERNET\\
			  \hspace*{2cm}localhost = PANTHERNET\newline\newline
				  [logging]\\
				  \hspace*{2cm}kdc = FILE:/var/log/krb5kdc.log\\
				  \hspace*{2cm}admin\_server = FILE:/var/log/kadmin.log\\
				  \hspace*{2cm}default = FILE:/var/log/krb5lib.log}
  
  A logolás (logging) nem túl érdekes. A libdefaults tartalmazza az alapértelmezett beállításokat. Az első sor a jegy
  élettartamát adja meg, mely most egy nap. A következő az alapértelmezett realm, amely azért szükséges, hogy ne kelljen
  mindig kiírni, melyik realmról van szó. Az utolsó pedig azt jelzi, hogy a kapott jegyek továbbíthatók más szerverekre
  (például ssh-n keresztül).
  
  Amennyiben a kerberos szerver másik gépen van (nálam ugyanaz), akkor szükség van még egy beállításra a fenti hármon
  felül. Ez mondja meg, hogy hány másodperccel térhet el a kerberos szerver és az aktuális gép rendszerórája. A név a
  \texttt{clockskew}, alapértelmezett értéke 300 (5 perc). Többit lásd \texttt{man 5 krb5.conf}.
  
  A következő szakasz azt mondja meg, hogy hol keresse a kerberos szervereket egy adott realmhoz. Jelen esetben a kdc is
  és az kadmin szerver is a gépemen van, a 88-as illetve 749-es porton. Próbáltam localhost-ot megadni, de az nem
  működött rendesen. Ugyanitt megadható több további realm is. Ha így nem szerepel, akkor még van egy lehetőség, hogy az
  adott realm nevének megfelelő dns bejegyzéseket keres.

  Tegyük fel, hogy két kerberos szerverünk van, kdc1 és kdc2. Ekkor a DNS bejegyzések a következők lesznek:

  \ut{\_kerberos.\_udp   IN SRV 1 0 88 kdc1\\
    \_kerberos.\_tcp   IN SRV 1 0 88 kdc1\\
    \_kerberos.\_udp   IN SRV 10 0 88 kdc2\\
    \_kerberos.\_tcp   IN SRV 10 0 88 kdc2\\
    \_kerberos-adm.\_tcp IN SRV 1 0 749 kdc1\\
    \_kpasswd.\_udp   IN SRV 1 0 464 kdc1\\
    \_kerberos IN TXT "EXAMPLE.COM"
  }

  Itt a gépnevek végén nincsen pont, ezért a tartományon belül szerepelnek, pl. a gépem esetén így egészülne ki:\\
  \ut{\_kerberos.udp.panthernet. IN SRV 1 0 88 kdc1.panthernet.}

  A kdc1 az elsődleges kerberos kiszolgáló, ezért az SRV bejegyzés után álló számot kisebbre kell állítani (1 versus
  10). A 88 a kdc standard (krb5-ös) portja (tcp + udp), 749 pedig a kadmin szerveré. A jelszóváltoztatást is és a realm
  felügyeletét is a kdc1-en keresztül lehet megtenni.

  A krb5.conf fájl következő szakasza a \texttt{[domain\_realm]}, amely azt adja meg, melyik géphez melyik realm
  tartozik. Itt lehet tartomány is, ilyenkor ponttal kezdődik, és lehet konkrét gép is. Erre példa a
  \texttt{.panthernet} és a \texttt{localhost}. Mindkettőhoz a \texttt{PANTHERNET} realm tartozik.

  Ha így nem található meg egy géphez tartozó realm, akkor a rendszer levágja a domain nevet, pl. foo.example.com esetén
  ez az example.com, és megnézi, hogy a domain névhez milyen TXT bejegyzés tartozik. A fenti példában az
  EXAMPLE.COM. Továbbá megnézi a fent megadott \_kerberos.* bejegyzéseket is, amely révén megtalálja a géphez tartozó
  kerberos kiszolgálót.

  
  \subsubsection{A realm létrehozása}
  A(z elsődleges) KDC-n a \texttt{kadmin.local} programmal lehet adminisztrálni a realmot. Ha ezt még nem hoztuk létre,
  akkor ilyen hibaüzenetet kapunk:
  
  \ut{\# kadmin.local\\
  Authenticating as principal root/admin@PANTHERNET with password.\\
  kadmin.local: No such file or directory while initializing kadmin.local interface}

  \newpage
  Hozzuk létre (PANTHERNET helyére értelemszerűen mást írva):
  
  \ut{\# kdb5\_util create -s -r  PANTHERNET\\
    Loading random data\\
    Initializing database '/etc/krb5kdc/principal' for realm 'PANTHERNET',\\
    master key name 'K/M@PANTHERNET'\\
    You will be prompted for the database Master Password.\\
    It is important that you NOT FORGET this password.\\
    Enter KDC database master key:\\
    Re-enter KDC database master key to verify:
  }
  
  A realm adatbázisa (fájlja) a következő: \texttt{/etc/krb5kdc/principal}. A fájlt jelszó védi, amit érdemes felírni és
  jól elzárt helyen tárolni. Enélkül könnyen visszaélhet valaki a jogosultságokkal. Ha nem ismert a jelszó, akkor nem
  lesz mindenre jogunk (nekem helyi gépen nem sikerült helyzetet produkálni, talán csak szerencsém volt).
  
  A legfontosabb bejegyzés a \texttt{K/M@PANTHERNET}, ezt TILOS kiexportálni, mert ennek ismeretében bármilyen
  változtatást megtehet a szerveren az, aki csak akar...

  Ha meg kell adni a mesterjelszót a \texttt{kadmin.local}-nak, akkor azt a parancs után megadott \texttt{-m} opcióval
  tehetjük meg. A program indulás után bekéri a jelszót.

  \subsection{A kerberos bejegyzések létrehozása és listázása}
  A \texttt{kadmin.local} kliens programot elindítva elkedhetjük a felhasználókat és a szolgáltatásokat megadni. Első lépésben
  házirendeket (policy) érdemes létrehozni, amelynek most különösebb szerepe nincsen, viszont bármikor szükséges lehet a
  szabályok szigorítása, és így általánosan kezelhetjük a felhasználókat.
  
  A kliensben van segítség is, mely a \texttt{help} parancs hatására jön elő, illetve egy nem teljesen megadott parancs
  is kiírja paraméterezését. A parancsoknak van hosszabb és rövidebb formájuk is.

  \ut{\# kadmin.local\\
    Authenticating as principal root/admin@PANTHERNET with password.
    kadmin.local:  \emph{\textbf{addpol}}\\
    add\_policy: parser lost count!\\
    usage; add\_policy [options] policy\\
    \hspace*{1.5cm}options are:\\
    \hspace*{3cm}[-maxlife time] [-minlife time] [-minlength length]\\
    \hspace*{3cm}[-minclasses number] [-history number]\\
    kadmin.local: \emph{\textbf{addpol users}}\\
    kadmin.local: \emph{\textbf{addpol admin}}\\
    kadmin.local: \emph{\textbf{addpol hosts}}
    }
  
  A fenti 3 házirenddel szétválaszthatjuk a jogosultságok szerint az ún. \emph{pricipal}-okat (a létrehozott
  bejegyzéseket).

  Az enyémet (normál ill. admin változatban) így lehet hozzáadni (a parancs 2 alakját használva a 3-ból):
  
  \ut{kadmin.local: \emph{\textbf{ank -policy users panther}}\\
    Enter password for principal "panther@PANTHERNET":\\
    Re-enter password for principal "panther@PANTHERNET":\\
    Principal "panther@PANTHERNET" created.\\
    kadmin.local: \emph{\textbf{addprinc -policy admin panther/admin}}\\
    Enter password for principal "panther/admin@PANTHERNET":\\
    Re-enter password for principal "panther/admin@PANTHERNET":\\
    Principal "panther/admin@PANTHERNET" created.
  }
  
  
  Ha ki szeretnénk listázni az összeset, akkor a következőképp járjunk el (és ilyesmilyen kimenetet kapunk):

  \ut{kadmin.local: \emph{\textbf{listprincs}}\\
    K/M@PANTHERNET\\
    \ldots\\
    panther/admin@PANTHERNET
  }
  
  Normál felhasználóként indítva más promptot kapunk és másképp kell indítani:

  \ut{panther ~ \$ /usr/sbin/kadmin
    Couldn't open log file /var/log/kadmin.log: Permission denied\\
    Couldn't open log file /var/log/kadmin.log: Permission denied\\
    Authenticating as principal panther/admin@PANTHERNET with password.\\
    Password for panther/admin@PANTHERNET:\\
    kadmin:}
  
  Az első két sor elfogadható, hiszen csak a rootnak szabad írnia a log fájlokat. Utána kiírja, hogy a felhasználói fiók
  admin változatával próbál csatlakozni, ehhez bekéri a jelszót.
  
  Ekkor sajnos még nincs jogunk listázni sem a principal-okat.
  
  A kdc-t tartalmazó géphez tartozó principal hozzáadása:
  
  \ut{kadmin.local:  \emph{\textbf{addprinc -randkey -policy hosts host/zeratul.panthernet}}\\
    Principal "host/zeratul.panthernet@PANTHERNET" created.\\
    kadmin.local:  \emph{\textbf{ktadd -k /etc/krb5.keytab host/zeratul.panthernet}}\\
    Entry for principal host/zeratul.panthernet with kvno 3, encryption type Triple DES cbc mode with HMAC/sha1 added to
    keytab WRFILE:/etc/krb5.keytab.\\    
    Entry for principal host/zeratul.panthernet with kvno 3, encryption type DES cbc mode with CRC-32 added to keytab
    WRFILE:/etc/krb5.keytab.
    }
  
  Most nem kell jelszó, ezért egy véletlen kulcsot generál a program a \texttt{-randkey} opció hatására. Mivel a
  kiszolgáló nem adhat meg jelszót, ezért jelszava például a \texttt{/etc/krb5.keytab} fájlban tárolódik, vagy másban, a
  lényeg, hogy csak a kiszolgáló felhasználója tudja olvasni. Itt most ebbe a fájlba került.
  

  \subsubsection{A KDC beállítása}
  A  KDC beállítófájlja, amin nem nagyon kell változtatni (/etc/kdc.conf):

  \ut{[kdcdefaults]\\
    kdc\_ports = 88,750\newline\newline
    [realms]\\
        PANTHERNET = \{\\
        database\_name = /etc/krb5kdc/principal\\
        admin\_keytab = /etc/krb5kdc/kadm5.keytab\\
        acl\_file = /etc/krb5kdc/kadm5.acl\\
        dict\_file = /etc/krb5kdc/kadm5.dict\\
        key\_stash\_file = /etc/krb5kdc/.k5.PANTHERNET\\
        kadmind\_port = 749\\
        max\_life = 10h 0m 0s\\
        max\_renewable\_life = 7d 0h 0m 0s\\
        master\_key\_type = des3-hmac-sha1\\
        supported\_enctypes = des3-hmac-sha1:normal des-cbc-crc:normal\\
        \}}

  Egy KDC több realmot is kiszolgálhat. Amennyiben automatikusan szeretnénk elindítani, a mester jelszó megadása
  nélkül, akkor a \texttt{key\_stash\_file} opcióban megadott fájlra szükségünk van, ellenkező esetben töröljük le. Az
  automatikus indítás a biztonság rovására megy, mert a fájl megszerzésével vissza lehet élni.
  
  A \texttt{/etc/krb5kdc/kadm5.acl} fájl tartalmazza a jogosultságokat, jelen esetben:

  \ut{*/admin@PANTHERNET      *}
  
  vagyis az összes adminnak mindenhez van joga.
  
  A \texttt{/etc/krb5kdc/kadm5.keytab} az admin keytab (kulcsokat tartalmazó fájl), ide két principal-t kell betenni:
  
  \ut{kadmin.local:  \emph{\textbf{ktadd -k /etc/krb5kdc/kadm5.keytab kadmin/admin kadmin/changepw}}\\
    Entry for principal kadmin/admin with kvno 3, encryption type Triple DES cbc mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5kdc/kadm5.keytab.\\
    Entry for principal kadmin/admin with kvno 3, encryption type DES cbc mode with CRC-32 added to keytab WRFILE:/etc/krb5kdc/kadm5.keytab.\\
    Entry for principal kadmin/changepw with kvno 4, encryption type Triple DES cbc mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5kdc/kadm5.keytab.\\
    Entry for principal kadmin/changepw with kvno 4, encryption type DES cbc mode with CRC-32 added to keytab WRFILE:/etc/krb5kdc/kadm5.keytab.\\
  }

  \subsection{Szolgáltatások hozzáadása}
  Tegyük fel, hogy a cyrus szervert szeretnénk beüzemelni. Neki külön keytab fájl kell, ezt a következőképpen tehetjük
  meg (kadmin vagy kadmin.local is jó):
  
  \ut{admin.local:  \emph{\textbf{addprinc -randkey -policy hosts imap/zeratul.panthernet}}\\
    Principal "imap/zeratul.panthernet@PANTHERNET" created.\\
    kadmin.local:  \emph{\textbf{ktadd -k /etc/krb5.keytab.cyrus imap/zeratul.panthernet}}\\
    Entry for principal imap/zeratul.panthernet with kvno 3, encryption type Triple DES cbc mode with HMAC/sha1 added to
    keytab WRFILE:/etc/krb5.keytab.cyrus.\\    
    Entry for principal imap/zeratul.panthernet with kvno 3, encryption type DES cbc mode with CRC-32 added to keytab
    WRFILE:/etc/krb5.keytab.cyrus.\\    
  }

  Bármely további szolgáltatást hasonlóképpen, \emph{szolgáltatásnév/szervernév}  formában megadhatunk. Itt a
  /etc/krb5.keytab.cyrus fájl a cyrus tulajdonában lévő, csak általa olvasható (és esetleg írható) fájl.


  \subsection{Jegyek igénylése, kezelése}
  Általában bejelentkezéskor kapunk egy jegyet, ahogy fentebb elhangzott, a \emph{tgt}-t, azonban néha szükség lehet
  arra, hogy menet közben ezt eldobjuk, vagy éppen másik realmból szeretnénk jegyet kapni.

  Például bejelentkeztem az \texttt{INF.ELTE.HU} tartományba, és a host ticketeknek megfelelően a 3 gépre:
  
  \ut{\$ klist\\
    Ticket cache: FILE:/tmp/krb5cc\_1000\\
    Default principal: panther@INF.ELTE.HU\\
    \\
    Valid starting\ \ \ \ \ Expires\ \ \ \ \ \ \ \ \ \ \ \ Service principal\\
    07/30/06 23:59:19\  07/31/06 09:59:30\ \ krbtgt/INF.ELTE.HU@INF.ELTE.HU\\
    \ \ \ \ \ \ \ \ renew until 07/31/06 23:59:19\\
    07/30/06 23:59:54\ \ 07/31/06 09:59:30\ \ host/valerie.inf.elte.hu@INF\ldots\\
    \ \ \ \ \ \ \ \ renew until 07/31/06 23:59:19\\
    07/30/06 23:59:54\ \ 07/31/06 09:59:30\ \ host/panda.inf.elte.hu@INF\ldots\\
    \ \ \ \ \ \ \ \ renew until 07/31/06 23:59:19\\
    07/30/06 23:59:54\ \ 07/31/06 09:59:30\ \ host/pandora.inf.elte.hu@INF\ldots\\
    \ \ \ \ \ \ \ \ renew until 07/31/06 23:59:19
  }
  
  Itt a jegy a \texttt{/tmp/krb5cc\_1000} fájlban van, amelyben az alapértelmezett (principal) a
  \texttt{panther@INF.ELTE.HU}.
  
  Ennek eldobása:
  
  \ut{kdestroy}
  
  Ha nincsen ``default principal'', akkor a \texttt{/etc/krb5.conf} alapértelmezett realm-ját veszi alapul, ellenkező
  esetben a principalt újítja meg:
  
  \ut{\$ kinit\\
  Password for panther@INF.ELTE.HU: }
  
  A \texttt{kinit} egyik legfontosabb opciója a \texttt{-f} és a \texttt{-F}, az előbbivel lehet \emph{továbbítható
  (forwardable)} jegyet igényelni, utóbbi pedig letiltja ezt. Ha továbbítható a jegy, akkor jelszókérés nélkül be lehet
  jelentkezni másik gépre is, ugyanis a jegy azonosít minket.

  
  \subsection{A pam beállítása}
  Ahhoz, hogy bejelentkezéskor a kerberosban tárolt jelszavunkat használjuk, be kell állítani a PAM-ban a kerberos
  használatát.
  
  A PAM a ``Pluggable Authentication Modules for Linux'' rövidítése, olyan hitelesítő modulokból áll, amelyek szabadon
  cserélhetőek. A változtatások azonnal érvénybe lépnek, a PAM-ot használó alkalmazás újraindítása nélkül is. A
  beállításokat a \texttt{/etc/pam.d} könyvtár tartalmazza.
  
  A Gentoo Linuxon az általánosan használt rész egy külön fájlban,\\ a \texttt{/etc/pam.d/system-auth}-ban van:

  \ut{\begin{tabular}{llll}%{\hspace{0.4cm}l\hspace{0.4cm}l\hspace{0.4cm}l\hspace{0.2cm}l}
    auth      & required    & pam\_env.so&\\
    auth      & sufficient  & pam\_unix.so &likeauth nullok\\
    auth      & sufficient  & pam\_krb5.so &use\_first\_pass forwardable\\
    auth      & required    & pam\_deny.so&\\\\
    account   & required    & pam\_unix.so&\\\\
    password  & required    & pam\_cracklib.so &difok=2 minlen=8 dcredit=2\textbackslash\\
    &&&\hspace*{1cm}ocredit=2 retry=3\\
    password  & sufficient &  pam\_unix.so& nullok md5 shadow use\_authtok\\
    password  & sufficient &  pam\_krb5.so &use\_first\_pass\\
    password  & required   &  pam\_deny.so&\\\\
    session   & required  &   pam\_limits.so&\\
    session    &sufficient &  pam\_unix.so&\\
    session    &sufficient  & pam\_krb5.so&\\
    session    &required    & pam\_deny.so&\\
    session    &required    &pam\_unix.so&
    \end{tabular}
    }
  
  Ez egy tipikusan hibás fájl, ami viszont jól szerepel benne: a \texttt{pam\_krb5}-öt ugyanúgy kell kezelni, mint a
  \texttt{pam\_unix}-ot. Az előbbi az első jelszót használja, ha nem sikerülne a \texttt{pam\_unix} jelszóellenőrzése,
  valamint továbbítható jegyet kér.

  Hogyan lehet használni a fenti fájlt? Például így:
  
  \ut{\begin{tabular}{lll}
      auth      & required    & pam\_nologin.so\\
      auth      & include     & system-auth\\
      account   & include     & system-auth\\
      session   & include     & system-auth
    \end{tabular}
  }
  
  \newpage
  \section{Cyrus (IMAP)}
  A Cyrus IMAP szerverhez fel kell tenni a következő csomagokat (a SASL-ra legfőképpen későbbb lesz szükség).

  \ut{dev-libs/cyrus-sasl\\
     net-mail/cyrus-imap-admin\\
     net-mail/cyrus-imapd\\
  }

   Korábban már láttuk, hogyan lehet az \texttt{imap/zeratul.panthernet@PANTHERNET} principal-t hozzáadni a rendszerhez,
   a továbbiakban szükség lesz rá. Tegyük fel, hogy \textt{kinit}-tel már azonosítottuk magunkat. Ekkor kipróbálhatjuk a
   már elindított imap szervert:
   
   \ut{\$ \emph{\textbf{imtest -m  GSSAPI -u panther  zeratul.panthernet}}\\
     S: * OK zeratul Cyrus IMAP4 v2.2.12-Gentoo server ready\\
     C: C01 CAPABILITY\\
     S: * CAPABILITY IMAP4 IMAP4rev1 ACL QUOTA LITERAL+ MAILBOX-REFERRALS NAMESPACE UIDPLUS ID NO\_ATOMIC\_RENAME UNSELECT CHILDREN MULTIAPPEND BINARY SORT THREAD=ORDEREDSUBJECT
     THREAD=REFERENCES ANNOTATEMORE IDLE STARTTLS LOGINDISABLED AUTH=GSSAPI SASL-IR LISTEXT LIST-SUBSCRIBED X-NETSCAPE\\
     S: C01 OK Completed
     }
   
   \noindent Hogyha nem menne, akkor a \texttt{/etc/cyrus.conf} fájlt kell módosítani:
   
   \ut{SERVICES \{\\
     \# Add or remove based on preferences.\\
     imap          cmd="imapd" listen="imap2" prefork=0\\
     pop3          cmd="pop3d" listen="pop-3" prefork=0\\
     \\
     \# Don't forget to generate the needed keys for SSL or TLS\\
     \# (see doc/html/install-configure.html).\\
     imaps         cmd="imapd -s" listen="imaps" prefork=0\\
     \#pop3s                cmd="pop3d -s" listen="pop3s" prefork=0\\
     \\
     sieve         cmd="timsieved" listen="sieve" prefork=0\\
     \\
     \# at least one LMTP is required for delivery\\
     \#lmtp         cmd="lmtpd" listen="lmtp" prefork=0\\
     lmtpunix      cmd="lmtpd" listen="/var/imap/socket/lmtp" prefork=0\\
     \\
     \# this is only necessary if using notifications\\
     \#notify       cmd="notifyd" listen="/var/imap/socket/notify" proto="udp" prefork=1
     \}
   }
   
   \noindent Ennek megfelelően a postfix beállítása:
   
   \ut{mailbox\_transport = lmtp:unix:/var/imap/socket/lmtp}

   \noindent Itt az imap, pop3, imaps portok engedélyezettek, utóbbihoz szükség van egy CA által aláírt tanúsítványra is
   
   \ut{\#/etc/imapd.conf részlet\\
     tls\_ca\_file:            /etc/ssl/panthernet.ca.crt\\
     tls\_cert\_file:          /etc/ssl/cyrus/server.crt\\
     tls\_key\_file:           /etc/ssl/cyrus/server.key\\
   }
   
   \noindent A fenti beállítások mellett előjött az a hiba, hogy a \texttt{saslauthd} nem futott, valamint a postfixnak
   nem volt joga a cyrus unix foglalatához:

   \ut{Oct 30 09:51:12 zeratul imaps[9961]: starttls: SSLv3 with cipher AES256-SHA (256/256 bits reused) no authentication\\
     Oct 30 09:51:19 zeratul imaps[9961]: cannot connect to saslauthd server: No such file or directory\\
     Oct 30 09:51:19 zeratul imaps[9961]: badlogin: zeratul.panthernet [10.0.1.101] plaintext panther SASL(-1): generic
     failure: checkpass failed\\\\
     Oct 30 09:52:51 zeratul postfix/pickup[9204]: AE99D79BB78E: uid=1000 from=<panther>
     Oct 30 09:52:51 zeratul postfix/cleanup[10026]: AE99D79BB78E: message-id=<20051030085251.AE99D79BB78E@zeratul.panthernet>
     Oct 30 09:52:51 zeratul postfix/qmgr[9205]: AE99D79BB78E: from=<panther@zeratul.panthernet>, size=488, nrcpt=1 (queue active)\\
     Oct 30 09:52:51 zeratul postfix/lmtp[10029]: AE99D79BB78E: to=<panther@zeratul.panthernet>, orig\_to=<panther>,\\
     relay=none, delay=0, status=deferred (connect to /var/imap/socket/lmtp[/var/imap/socket/lmtp]: Permission denied)\\
   }
   

   
   \noindent A Cyrus imap fájlját a következő módon tettem elérhetővé a postfix számára:
   
   \ut{zeratul socket \# setfacl -m u:postfix:x ..\\
     zeratul socket \# setfacl -m u:postfix:x .\\
     zeratul socket \# setfacl -m u:postfix:rw lmtp\\
     zeratul socket \# l\\
     összesen 12\\
     drwxr-x---+~~2 cyrus mail~~~88 okt 30 09:58 ./\\
     drwxr-x---+~12 cyrus mail 4096 okt 30 09:51 ../\\
     -rw-------~~~1 cyrus mail~~~~0 okt 29 23:18 imap-1.lock\\
     -rw-------~~~1 cyrus mail~~~~ 0 okt 30 09:25 imaps-1.lock\\
     -rw-r--r--~~~1 root~~root~~~~0 okt 29 23:09 .keep\\
     srwxrwxrwx+~~1 cyrus mail~~~~0 okt 30 09:51 lmtp=
   }

   \newpage
   \section{Amavisd-New, ClamAV, SpamAssassin}
   Az Amavisd-new egy általános célú levélszűrő, spam- és vírusszűrő programokat hív meg és az általuk adott válasz
   alapján eldönti, hogy az adott levél spam-e, vagy épp vírusos-e.

   Egy minimális konfiguráció (amit be kell állítani) a következő:
   
   \ut{\# /etc/amavisd.conf\\
     \$mydomain = 'panthernet';\\
     \$myhostname = 'zeratul.panthernet';\\
     \$daemon\_user  = 'amavis';       \# (no default;  customary: vscan or amavis)\\
     \$daemon\_group = 'clamav';       \# (no default;  customary: vscan or amavis)\\
     \$virus\_admin = "panther@\$mydomain";\\\
     \$mail\_notify\_admin = "antivirus@\$mydomain";\\
     \$mail\_notify\_spamadmin = "antivirus@\$mydomain";\\
      \# \#\#\# http://www.clamav.net/\\
%%	 ['ClamAV-clamd',\\
%% 	  \textbackslash\&ask\_daemon, ["CONTSCAN \{\}\textbackslash n", "/var/run/clamav/clamd.sock"],\\
%%	  qr/\textbackslash bOK\$/, qr/\textbackslash bFOUND\$/,\ldots\
   }
   
   Az amavisnak a clamav-vel azonos csoportban kell lennie, hogy olvashassa a clamav socket fájlját, a
   \texttt{/var/run/clamav/clamd.sock}-t.
   A \texttt{mail\_notify*} a levelek feladója, ha értesítést küld a rendszer, hogy spamet vagy mást talált.
   

   Illetve be kell állítani, hogy a könyvtár (\texttt{/var/amavis}) megfelelő tulajdonú legyen:

   \ut{\# chown -R amavis:amavis /var/amavis}
   
   \subsection{A ClamAV beállítása}
   A ClamAV alapértelmezett konfigja csak példa, ezért egy hashmark (\#) karaktert kell az ``Example'' sor elé tenni:

   \ut{\# Example
     LogFile /var/log/clamav/clamd.log
     LocalSocket /var/run/clamav/clamd.sock
   }
   
   A \textt{LocalSocket} ugyanaz legyen, mint ami az \texttt{/etc/amavisd.conf}-ban szerepel. Ha ez megvan, már
   működőképes a rendszer.

   \subsection{A Postfix beállítása az Amavisd-New használatára}

   A \texttt{/etc/postfix/master.cf} fájlban kell módosítani, az első három sor talán nem kell...
   
   \ut{\# submission=587\\
     submission   inet    n       -       n       -       -       smtpd\\
     -o smtpd\_enforce\_tls=yes -o smtpd\_sasl\_auth\_enable=yes -o smtpd\_etrn\_restrictions=reject\\
     \#\#\#\\
     \# AMAVIS etc
     127.0.0.1:10025 inet n  -       n       -       -       smtpd\\
     -o content\_filter=\\
     -o local\_recipient\_maps=\\
     -o smtpd\_client\_restrictions=\\
     -o smtpd\_helo\_restrictions=\\
     -o smtpd\_sender\_restrictions=\\
     -o smtpd\_restrictions=permit\_mynetworks,reject\_unauth\_destination\\
     -o mynetworks=127.0.0.0/8\\
     -o strict\_rfc821\_envelopes=yes\\
     -o smtpd\_error\_sleep\_time=0\\
     -o smtpd\_soft\_error\_limit=1001\\
     -o smtpd\_hard\_error\_limit=1000\\
     smtp-amavis     unix    -       -       y       -       2       smtp\\
     -o smtp\_data\_done\_timeout=1200\\
     -o disable\_dns\_lookups=yes
   }

   \noindent A \texttt{/etc/postfix/master.cf} fájlban is kell egy új sor:

   \ut{content\_filter = smtp-amavis:[127.0.0.1]:10024}

   Mi is történik ekkor? A Postfix kap egy levelet a 25-ös porton. Ezt továbbadja a localhost 10024-es portjára az
   amavisd-new-nak. Az amavisd-new meghívja a spam- és vírusszűrőket, majd visszaküldi a levelet a postfixnak a
   localhost 10025-ös portján. Bizonyos feltételek mellett bármikor blokkolódhat a levél. Ha az amavis karanténba zárja,
   akkor értesítést küld, alapesetben a localhost 10025-ös portjára.

   
   \newpage
   \section{SSL, OpenLDAP, SASL beállítása}
   Az OpenLDAP is támogatja a Kerberost, ehhez neki is meg kell adni egy keytab fájlt. A szolgáltatásnév
   \texttt{ldap/gepnev}. Például:

   \ut{kadmin.local:  \emph{\textbf{ktadd -k /etc/krb5.keytab.ldap ldap/zeratul.panthernet}}\\
     Entry for principal ldap/zeratul.panthernet with kvno 3, encryption type Triple DES cbc mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5.keytab.ldap.\\
     Entry for principal ldap/zeratul.panthernet with kvno 3, encryption type DES cbc mode with CRC-32 added to keytab
     WRFILE:/etc/krb5.keytab.ldap.}

   \noindent A \texttt{/etc/openldap/slapd.conf} fájlt be kell állítani a SASL (GSSAPI) használatára:
   
   \ut{sasl-realm panthernet\\
     sasl-regexp uid=([\^,]+),.*cn=GSSAPI uid=\$1,ou=People,dc=panthernet\\
     sasl-host zeratul.panthernet
   }

   \noindent Az init scriptben meg kell adni, hol van a keytab fájl, még a slapd indulása előtt:

   \ut{export KRB5\_KTNAME=/etc/krb5.keytab.ldap}

   \noindent Kerberos ticket nélkül:
   
   \ut{panther@zeratul ~ \$ \emph{\textbf{ldapsearch -Y GSSAPI  uid=panther}}\\
     SASL/GSSAPI authentication started\\
     ldap\_sasl\_interactive\_bind\_s: Local error (-2)\\
     additional info: SASL(-1): generic failure: GSSAPI Error: Miscellaneous failure (No credentials cache found)\\
     panther@zeratul ~ \$ \emph{\textbf{ldapsearch   uid=panther}}\\
     ldap\_sasl\_interactive\_bind\_s: No such object (32)
   }
   

   Azzal együtt már működik:
   \ut{\$ \emph{\textbf{ldapsearch -Y GSSAPI  uid=panther}}}

   
   \section{Levelezőkliensek beállítása}
   \subsection{Mutt}
   A mutt rendszerszintű beállítófájljában, a \texttt{/etc/mutt/Muttrc}-ben a következőket állítjuk be:
  
   \ut{set certificate\_file="/etc/openldap/ssl/cacert.pem"\\
     set move=no
     set hostname=panthernet\\
     set ssl\_starttls=yes\\
     set folder=\$MAIL
   }

   Az első a CA tanúsítványát jelöli, a 3. azért kell, hogy ne a gépnév.domain alakú email cím legyen, ha elküld a
   rendszer egy levelet, a 4. az SSL/TLS titkosítást állítja be, végül az utolsó az IMAP könyvtár helye (INBOX), ami egy
   környezeti változó:

   \ut{export MAIL=\{\$USER@zeratul.panthernet\}INBOX}
   

     

%%   exim -qff
%% exim_tidydb -t 7d -f /var/spool/exim wait-amavis 
%% exim_tidydb -t 7d -f /var/spool/exim wait-remote_smtp
%% exim_tidydb -t 7d -f /var/spool/exim retry
%% exim -bpru | egrep ^.[78]d | awk '{print $3}' | wc -l | xargs exim -Mrm

  
\end{document}
